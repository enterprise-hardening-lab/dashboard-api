name: ğŸ§© App Container Governance

on:
  push:
    branches: [ main ]
  workflow_dispatch:

# ğŸ‘‡ Workflow token permissions for both jobs
permissions:
  id-token: write
  contents: read
  actions: read
  security-events: write

jobs:
  orchestrate:
    name: ğŸ§© Run Central Orchestrator
    uses: enterprise-hardening-lab/container-hardening-orchestrator/.github/workflows/orchestrator.yml@main
    with:
      app_name: "dashboard-api"
      base_image: "ubuntu"
    secrets: inherit
    permissions:
      id-token: write
      contents: read
      actions: read
      issues: write
      security-events: write

  upload_sarif:
    name: ğŸ“¤ Upload Semgrep SARIF to GitHub Security Alerts
    runs-on: ubuntu-latest
    needs: orchestrate
    permissions:
      security-events: write
      contents: read
    steps:
      - name: ğŸ§© Checkout
        uses: actions/checkout@v4

      - name: â¬‡ï¸ Download Semgrep Report Artifact
        uses: actions/download-artifact@v4
        with:
          name: semgrep-report
          path: reports/generated

      - name: ğŸ“¤ Upload SARIF Report to GitHub Security Alerts
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: reports/generated/semgrep-report.sarif
